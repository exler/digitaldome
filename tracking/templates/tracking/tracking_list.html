{% extends "base.html" %}
{% load digitaldome_tags entities %}
{% block title %}
    {{ entity_type|title }}
{% endblock title %}
{% block content %}
    <div class="flex flex-col gap-6">
        {# User header - reusing from dashboard #}
        <div class="border-3 border-black bg-white p-6" style="box-shadow: 5px 5px 0px 0px #000;">
            <div class="flex items-center gap-4">
                <div class="relative">
                    <div class="w-20 h-20 rounded-full border-3 border-black bg-gray-300 overflow-hidden">
                        <img src="{{ user.avatar_url }}" 
                             alt="{{ user.username }}"
                             class="w-full h-full object-cover">
                    </div>
                    <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-neo-yellow border-2 border-black"></div>
                </div>
                
                <div>
                    <h1 class="text-2xl font-bold">{{ user.username }}</h1>
                    {% if user.is_staff %}
                        <span class="inline-block mt-2 px-2 py-1 bg-neo-yellow border-2 border-black text-xs font-bold uppercase">Moderator</span>
                    {% endif %}
                </div>
            </div>
            
            {# Navigation tabs #}
            <div class="flex flex-wrap gap-2 mt-4">
                <a href="{% url 'tracking:dashboard' user.id %}" class="btn btn-outline text-xs py-1 px-3">Dashboard</a>
                <a href="{% url 'tracking:tracking-list' user.id 'movies' %}" 
                   class="btn {% if entity_type == 'movies' %}btn-primary{% else %}btn-outline{% endif %} text-xs py-1 px-3">Movies</a>
                <a href="{% url 'tracking:tracking-list' user.id 'shows' %}" 
                   class="btn {% if entity_type == 'shows' %}btn-primary{% else %}btn-outline{% endif %} text-xs py-1 px-3">Shows</a>
                <a href="{% url 'tracking:tracking-list' user.id 'games' %}" 
                   class="btn {% if entity_type == 'games' %}btn-primary{% else %}btn-outline{% endif %} text-xs py-1 px-3">Games</a>
                <a href="{% url 'tracking:tracking-list' user.id 'books' %}" 
                   class="btn {% if entity_type == 'books' %}btn-primary{% else %}btn-outline{% endif %} text-xs py-1 px-3">Books</a>
            </div>
        </div>

        <div class="flex flex-col gap-4">
            <h2 class="text-2xl font-bold uppercase">{{ entity_type|title }}</h2>
            
            {# Filters #}
            <form method="get" class="flex flex-wrap gap-2">
                <select name="{{ filter.form.status.name }}"
                        class="border-2 border-black px-3 py-2 text-xs font-bold uppercase bg-white">
                    {% for option in filter.form.status.field.choices %}
                        {% if option.0 != '' %}
                            <option value="{{ option.0 }}"
                                    {% if option.0 == filter.form.status.data|toint %}selected{% endif %}>
                                {{ option.1 }}
                            </option>
                        {% endif %}
                    {% endfor %}
                </select>
                <select name="ordering" class="border-2 border-black px-3 py-2 text-xs font-bold uppercase bg-white">
                    <option value=""
                            {% if request.GET.ordering == "" or not request.GET.ordering %}selected{% endif %}>
                        Sort by
                    </option>
                    <option value="entity_name"
                            {% if request.GET.ordering == "entity_name" %}selected{% endif %}>Title A-Z</option>
                    <option value="-entity_name"
                            {% if request.GET.ordering == "-entity_name" %}selected{% endif %}>Title Z-A</option>
                    <option value="-rating"
                            {% if request.GET.ordering == "-rating" %}selected{% endif %}>Best rated</option>
                    <option value="rating"
                            {% if request.GET.ordering == "rating" %}selected{% endif %}>Worst rated</option>
                    <option value="-updated_at"
                            {% if request.GET.ordering == "-updated_at" %}selected{% endif %}>Recently updated</option>
                </select>
                <button type="submit" class="btn btn-primary text-xs">Filter</button>
            </form>
            
            {# List view #}
            <div class="border-3 border-black bg-white" style="box-shadow: 4px 4px 0px 0px #000;">
                <div class="grid grid-cols-[3rem_4rem_1fr_8rem_5rem] gap-2 p-2 bg-gray-100 border-b-2 border-black font-bold text-xs uppercase">
                    <div class="text-center">#</div>
                    <div></div>
                    <div class="text-left">Title</div>
                    <div class="text-center">Status</div>
                    <div class="text-center">Rating</div>
                </div>
                
                {% for object in page_obj %}
                    <a href="{% url 'entities:entities-detail' entity_type object.object_id %}"
                       class="grid grid-cols-[3rem_4rem_1fr_8rem_5rem] gap-2 p-2 hover:bg-gray-50 border-b border-gray-200 items-center">
                        <div class="text-center text-sm font-bold">{{ forloop.counter0|add:page_obj.start_index }}</div>
                        <div>
                            <img src="{{ object.content_object.image|imageurl }}"
                                 class="w-12 h-16 object-cover border-2 border-black"
                                 alt="{{ object.content_object.name }}">
                        </div>
                        <div class="text-sm font-bold">{{ object.content_object.name }}</div>
                        <div class="text-center text-xs font-bold uppercase">{{ object.get_status_display }}</div>
                        <div class="text-center">
                            {% if object.rating %}
                                <div class="flex items-center justify-center gap-1">
                                    <span class="text-sm font-bold">{{ object.rating }}</span>
                                    <svg class="w-4 h-4 text-black" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                    </svg>
                                </div>
                            {% else %}
                                <span class="text-xs font-bold text-gray-400">N/A</span>
                            {% endif %}
                        </div>
                    </a>
                {% empty %}
                    <div class="col-span-5 text-center p-8 text-sm font-bold uppercase">No tracked items.</div>
                {% endfor %}
            </div>
            
            {% if page_obj.has_other_pages %}
                {% include "partials/pagination.html" %}
            {% endif %}
        </div>
    </div>
{% endblock content %}
